; SPIR-V
; Version: 1.2
; Generator: rspirv
; Bound: 270
OpCapability Shader
OpExtension "SPV_KHR_storage_buffer_storage_class"
%1 = OpExtInstImport "GLSL.std.450"
OpMemoryModel Logical GLSL450
OpEntryPoint Vertex %97 "vs_main" %87 %90 %92 %94 %96
OpEntryPoint Fragment %151 "fs_main" %142 %145 %148 %150
OpEntryPoint Fragment %218 "fs_main_without_storage" %211 %213 %215 %217
OpExecutionMode %151 OriginUpperLeft
OpExecutionMode %218 OriginUpperLeft
OpSource GLSL 450
OpName %11 "c_max_lights"
OpMemberName %18 0 "view_proj"
OpMemberName %18 1 "num_lights"
OpName %18 "Globals"
OpMemberName %19 0 "world"
OpMemberName %19 1 "color"
OpName %19 "Entity"
OpMemberName %21 0 "proj_position"
OpMemberName %21 1 "world_normal"
OpMemberName %21 2 "world_position"
OpName %21 "VertexOutput"
OpMemberName %28 0 "proj"
OpMemberName %28 1 "pos"
OpMemberName %28 2 "color"
OpName %28 "Light"
OpName %38 "c_ambient"
OpName %39 "u_globals"
OpName %42 "u_entity"
OpName %45 "s_lights"
OpName %48 "u_lights"
OpName %51 "t_shadow"
OpName %53 "sampler_shadow"
OpName %56 "light_id"
OpName %57 "homogeneous_coords"
OpName %58 "fetch_shadow"
OpName %84 "out"
OpName %87 "position"
OpName %90 "normal"
OpName %92 "proj_position"
OpName %94 "world_normal"
OpName %96 "world_position"
OpName %97 "vs_main"
OpName %136 "color"
OpName %138 "i"
OpName %142 "proj_position"
OpName %145 "world_normal"
OpName %148 "world_position"
OpName %151 "fs_main"
OpName %205 "color"
OpName %207 "i"
OpName %211 "proj_position"
OpName %213 "world_normal"
OpName %215 "world_position"
OpName %218 "fs_main_without_storage"
OpMemberDecorate %18 0 Offset 0
OpMemberDecorate %18 0 ColMajor
OpMemberDecorate %18 0 MatrixStride 16
OpMemberDecorate %18 1 Offset 64
OpMemberDecorate %19 0 Offset 0
OpMemberDecorate %19 0 ColMajor
OpMemberDecorate %19 0 MatrixStride 16
OpMemberDecorate %19 1 Offset 64
OpMemberDecorate %21 0 Offset 0
OpMemberDecorate %21 1 Offset 16
OpMemberDecorate %21 2 Offset 32
OpMemberDecorate %28 0 Offset 0
OpMemberDecorate %28 0 ColMajor
OpMemberDecorate %28 0 MatrixStride 16
OpMemberDecorate %28 1 Offset 64
OpMemberDecorate %28 2 Offset 80
OpDecorate %29 ArrayStride 96
OpDecorate %30 ArrayStride 96
OpDecorate %39 DescriptorSet 0
OpDecorate %39 Binding 0
OpDecorate %40 Block
OpMemberDecorate %40 0 Offset 0
OpDecorate %42 DescriptorSet 1
OpDecorate %42 Binding 0
OpDecorate %43 Block
OpMemberDecorate %43 0 Offset 0
OpDecorate %45 NonWritable
OpDecorate %45 DescriptorSet 0
OpDecorate %45 Binding 1
OpDecorate %46 Block
OpMemberDecorate %46 0 Offset 0
OpDecorate %48 DescriptorSet 0
OpDecorate %48 Binding 1
OpDecorate %49 Block
OpMemberDecorate %49 0 Offset 0
OpDecorate %51 DescriptorSet 0
OpDecorate %51 Binding 2
OpDecorate %53 DescriptorSet 0
OpDecorate %53 Binding 3
OpDecorate %87 Location 0
OpDecorate %90 Location 1
OpDecorate %92 BuiltIn Position
OpDecorate %94 Location 0
OpDecorate %96 Location 1
OpDecorate %142 BuiltIn FragCoord
OpDecorate %145 Location 0
OpDecorate %148 Location 1
OpDecorate %150 Location 0
OpDecorate %211 BuiltIn FragCoord
OpDecorate %213 Location 0
OpDecorate %215 Location 1
OpDecorate %217 Location 0
%2 = OpTypeVoid
%4 = OpTypeInt 32 1
%3 = OpConstant  %4  10
%6 = OpTypeFloat 32
%5 = OpConstant  %6  0.0
%7 = OpConstant  %6  1.0
%8 = OpConstant  %6  0.5
%9 = OpConstant  %6  -0.5
%10 = OpConstant  %6  0.05
%12 = OpTypeInt 32 0
%11 = OpConstant  %12  10
%13 = OpConstant  %12  0
%14 = OpConstant  %12  1
%16 = OpTypeVector %6 4
%15 = OpTypeMatrix %16 4
%17 = OpTypeVector %12 4
%18 = OpTypeStruct %15 %17
%19 = OpTypeStruct %15 %16
%20 = OpTypeVector %6 3
%21 = OpTypeStruct %16 %20 %16
%22 = OpTypeVector %4 4
%23 = OpTypePointer Uniform %19
%24 = OpTypePointer Function %21
%25 = OpTypeMatrix %20 3
%26 = OpTypeVector %4 3
%27 = OpTypePointer Uniform %18
%28 = OpTypeStruct %15 %16 %16
%29 = OpTypeRuntimeArray %28
%30 = OpTypeArray %28 %3
%31 = OpTypeImage %6 2D 1 1 0 1 Unknown
%32 = OpTypeSampler
%33 = OpTypeVector %6 2
%34 = OpTypePointer Uniform %17
%35 = OpTypePointer StorageBuffer %29
%36 = OpTypePointer Function %12
%37 = OpTypePointer Uniform %30
%38 = OpConstantComposite  %20  %10 %10 %10
%40 = OpTypeStruct %18
%41 = OpTypePointer Uniform %40
%39 = OpVariable  %41  Uniform
%43 = OpTypeStruct %19
%44 = OpTypePointer Uniform %43
%42 = OpVariable  %44  Uniform
%46 = OpTypeStruct %29
%47 = OpTypePointer StorageBuffer %46
%45 = OpVariable  %47  StorageBuffer
%49 = OpTypeStruct %30
%50 = OpTypePointer Uniform %49
%48 = OpVariable  %50  Uniform
%52 = OpTypePointer UniformConstant %31
%51 = OpVariable  %52  UniformConstant
%54 = OpTypePointer UniformConstant %32
%53 = OpVariable  %54  UniformConstant
%59 = OpTypeFunction %6 %12 %16
%64 = OpTypeBool
%79 = OpTypeSampledImage %31
%85 = OpConstantNull  %21
%88 = OpTypePointer Input %22
%87 = OpVariable  %88  Input
%90 = OpVariable  %88  Input
%93 = OpTypePointer Output %16
%92 = OpVariable  %93  Output
%95 = OpTypePointer Output %20
%94 = OpVariable  %95  Output
%96 = OpVariable  %93  Output
%98 = OpTypeFunction %2
%102 = OpTypePointer Uniform %15
%109 = OpTypePointer Function %20
%121 = OpTypePointer Function %16
%122 = OpConstant  %12  2
%130 = OpTypePointer Output %6
%137 = OpConstantNull  %20
%139 = OpConstantNull  %12
%143 = OpTypePointer Input %16
%142 = OpVariable  %143  Input
%146 = OpTypePointer Input %20
%145 = OpVariable  %146  Input
%148 = OpVariable  %143  Input
%150 = OpVariable  %93  Output
%165 = OpTypePointer Uniform %12
%175 = OpTypePointer StorageBuffer %28
%201 = OpTypePointer Uniform %16
%206 = OpConstantNull  %20
%208 = OpConstantNull  %12
%211 = OpVariable  %143  Input
%213 = OpVariable  %146  Input
%215 = OpVariable  %143  Input
%217 = OpVariable  %93  Output
%241 = OpTypePointer Uniform %28
%58 = OpFunction  %6  None %59
%56 = OpFunctionParameter  %12
%57 = OpFunctionParameter  %16
%55 = OpLabel
%60 = OpLoad  %31  %51
%61 = OpLoad  %32  %53
OpBranch %62
%62 = OpLabel
%63 = OpCompositeExtract  %6  %57 3
%65 = OpFOrdLessThanEqual  %64  %63 %5
OpSelectionMerge %66 None
OpBranchConditional %65 %67 %66
%67 = OpLabel
OpReturnValue %7
%66 = OpLabel
%68 = OpCompositeConstruct  %33  %8 %9
%69 = OpCompositeExtract  %6  %57 3
%70 = OpFDiv  %6  %7 %69
%71 = OpVectorShuffle  %33  %57 %57 0 1
%72 = OpFMul  %33  %71 %68
%73 = OpVectorTimesScalar  %33  %72 %70
%74 = OpCompositeConstruct  %33  %8 %8
%75 = OpFAdd  %33  %73 %74
%76 = OpBitcast  %4  %56
%77 = OpCompositeExtract  %6  %57 2
%78 = OpFMul  %6  %77 %70
%80 = OpConvertUToF  %6  %76
%81 = OpCompositeConstruct  %20  %75 %80
%82 = OpSampledImage  %79  %60 %61
%83 = OpImageSampleDrefExplicitLod  %6  %82 %81 %78 Lod %5
OpReturnValue %83
OpFunctionEnd
%97 = OpFunction  %2  None %98
%86 = OpLabel
%84 = OpVariable  %24  Function %85
%89 = OpLoad  %22  %87
%91 = OpLoad  %22  %90
%99 = OpAccessChain  %27  %39 %13
%100 = OpAccessChain  %23  %42 %13
OpBranch %101
%101 = OpLabel
%103 = OpAccessChain  %102  %100 %13
%104 = OpLoad  %15  %103
%105 = OpAccessChain  %102  %100 %13
%106 = OpLoad  %15  %105
%107 = OpConvertSToF  %16  %89
%108 = OpMatrixTimesVector  %16  %106 %107
%110 = OpCompositeExtract  %16  %104 0
%111 = OpVectorShuffle  %20  %110 %110 0 1 2
%112 = OpCompositeExtract  %16  %104 1
%113 = OpVectorShuffle  %20  %112 %112 0 1 2
%114 = OpCompositeExtract  %16  %104 2
%115 = OpVectorShuffle  %20  %114 %114 0 1 2
%116 = OpCompositeConstruct  %25  %111 %113 %115
%117 = OpVectorShuffle  %26  %91 %91 0 1 2
%118 = OpConvertSToF  %20  %117
%119 = OpMatrixTimesVector  %20  %116 %118
%120 = OpAccessChain  %109  %84 %14
OpStore %120 %119
%123 = OpAccessChain  %121  %84 %122
OpStore %123 %108
%124 = OpAccessChain  %102  %99 %13
%125 = OpLoad  %15  %124
%126 = OpMatrixTimesVector  %16  %125 %108
%127 = OpAccessChain  %121  %84 %13
OpStore %127 %126
%128 = OpLoad  %21  %84
%129 = OpCompositeExtract  %16  %128 0
OpStore %92 %129
%131 = OpAccessChain  %130  %92 %14
%132 = OpLoad  %6  %131
%133 = OpFNegate  %6  %132
OpStore %131 %133
%134 = OpCompositeExtract  %20  %128 1
OpStore %94 %134
%135 = OpCompositeExtract  %16  %128 2
OpStore %96 %135
OpReturn
OpFunctionEnd
%151 = OpFunction  %2  None %98
%140 = OpLabel
%136 = OpVariable  %109  Function %137
%138 = OpVariable  %36  Function %139
%144 = OpLoad  %16  %142
%147 = OpLoad  %20  %145
%149 = OpLoad  %16  %148
%141 = OpCompositeConstruct  %21  %144 %147 %149
%152 = OpAccessChain  %27  %39 %13
%153 = OpAccessChain  %23  %42 %13
%154 = OpAccessChain  %35  %45 %13
%155 = OpLoad  %31  %51
%156 = OpLoad  %32  %53
OpBranch %157
%157 = OpLabel
%158 = OpCompositeExtract  %20  %141 1
%159 = OpExtInst  %20  %1 Normalize %158
OpStore %136 %38
OpStore %138 %13
OpBranch %160
%160 = OpLabel
OpLoopMerge %161 %163 None
OpBranch %162
%162 = OpLabel
%164 = OpLoad  %12  %138
%166 = OpAccessChain  %165  %152 %14 %13
%167 = OpLoad  %12  %166
%168 = OpExtInst  %12  %1 UMin %167 %11
%169 = OpULessThan  %64  %164 %168
OpSelectionMerge %170 None
OpBranchConditional %169 %170 %171
%171 = OpLabel
OpBranch %161
%170 = OpLabel
OpBranch %172
%172 = OpLabel
%174 = OpLoad  %12  %138
%176 = OpAccessChain  %175  %154 %174
%177 = OpLoad  %28  %176
%178 = OpLoad  %12  %138
%179 = OpCompositeExtract  %15  %177 0
%180 = OpCompositeExtract  %16  %141 2
%181 = OpMatrixTimesVector  %16  %179 %180
%182 = OpFunctionCall  %6  %58 %178 %181
%183 = OpCompositeExtract  %16  %177 1
%184 = OpVectorShuffle  %20  %183 %183 0 1 2
%185 = OpCompositeExtract  %16  %141 2
%186 = OpVectorShuffle  %20  %185 %185 0 1 2
%187 = OpFSub  %20  %184 %186
%188 = OpExtInst  %20  %1 Normalize %187
%189 = OpDot  %6  %159 %188
%190 = OpExtInst  %6  %1 FMax %5 %189
%191 = OpFMul  %6  %182 %190
%192 = OpCompositeExtract  %16  %177 2
%193 = OpVectorShuffle  %20  %192 %192 0 1 2
%194 = OpVectorTimesScalar  %20  %193 %191
%195 = OpLoad  %20  %136
%196 = OpFAdd  %20  %195 %194
OpStore %136 %196
OpBranch %173
%173 = OpLabel
OpBranch %163
%163 = OpLabel
%197 = OpLoad  %12  %138
%198 = OpIAdd  %12  %197 %14
OpStore %138 %198
OpBranch %160
%161 = OpLabel
%199 = OpLoad  %20  %136
%200 = OpCompositeConstruct  %16  %199 %7
%202 = OpAccessChain  %201  %153 %14
%203 = OpLoad  %16  %202
%204 = OpFMul  %16  %200 %203
OpStore %150 %204
OpReturn
OpFunctionEnd
%218 = OpFunction  %2  None %98
%209 = OpLabel
%205 = OpVariable  %109  Function %206
%207 = OpVariable  %36  Function %208
%212 = OpLoad  %16  %211
%214 = OpLoad  %20  %213
%216 = OpLoad  %16  %215
%210 = OpCompositeConstruct  %21  %212 %214 %216
%219 = OpAccessChain  %27  %39 %13
%220 = OpAccessChain  %23  %42 %13
%221 = OpAccessChain  %37  %48 %13
%222 = OpLoad  %31  %51
%223 = OpLoad  %32  %53
OpBranch %224
%224 = OpLabel
%225 = OpCompositeExtract  %20  %210 1
%226 = OpExtInst  %20  %1 Normalize %225
OpStore %205 %38
OpStore %207 %13
OpBranch %227
%227 = OpLabel
OpLoopMerge %228 %230 None
OpBranch %229
%229 = OpLabel
%231 = OpLoad  %12  %207
%232 = OpAccessChain  %165  %219 %14 %13
%233 = OpLoad  %12  %232
%234 = OpExtInst  %12  %1 UMin %233 %11
%235 = OpULessThan  %64  %231 %234
OpSelectionMerge %236 None
OpBranchConditional %235 %236 %237
%237 = OpLabel
OpBranch %228
%236 = OpLabel
OpBranch %238
%238 = OpLabel
%240 = OpLoad  %12  %207
%242 = OpAccessChain  %241  %221 %240
%243 = OpLoad  %28  %242
%244 = OpLoad  %12  %207
%245 = OpCompositeExtract  %15  %243 0
%246 = OpCompositeExtract  %16  %210 2
%247 = OpMatrixTimesVector  %16  %245 %246
%248 = OpFunctionCall  %6  %58 %244 %247
%249 = OpCompositeExtract  %16  %243 1
%250 = OpVectorShuffle  %20  %249 %249 0 1 2
%251 = OpCompositeExtract  %16  %210 2
%252 = OpVectorShuffle  %20  %251 %251 0 1 2
%253 = OpFSub  %20  %250 %252
%254 = OpExtInst  %20  %1 Normalize %253
%255 = OpDot  %6  %226 %254
%256 = OpExtInst  %6  %1 FMax %5 %255
%257 = OpFMul  %6  %248 %256
%258 = OpCompositeExtract  %16  %243 2
%259 = OpVectorShuffle  %20  %258 %258 0 1 2
%260 = OpVectorTimesScalar  %20  %259 %257
%261 = OpLoad  %20  %205
%262 = OpFAdd  %20  %261 %260
OpStore %205 %262
OpBranch %239
%239 = OpLabel
OpBranch %230
%230 = OpLabel
%263 = OpLoad  %12  %207
%264 = OpIAdd  %12  %263 %14
OpStore %207 %264
OpBranch %227
%228 = OpLabel
%265 = OpLoad  %20  %205
%266 = OpCompositeConstruct  %16  %265 %7
%267 = OpAccessChain  %201  %220 %14
%268 = OpLoad  %16  %267
%269 = OpFMul  %16  %266 %268
OpStore %217 %269
OpReturn
OpFunctionEnd